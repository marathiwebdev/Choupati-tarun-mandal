<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üö© ‡§ö‡•å‡§™‡§æ‡§ü‡•Ä ‡§§‡§∞‡•Å‡§£ ‡§Æ‡§Ç‡§°‡§≥ , ‡§ó‡•ã‡§∞‡§Ç‡§¨‡•á üö©</title>

  <!-- Google Font: Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Firebase v8 (CDN) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <style>
    :root { --orange:#ff9933; --red:#ff3300; }
    * { box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      background: #fff8dc;
      margin: 0; padding: 0;
    }
    header {
      position: sticky; top: 0;
      background: linear-gradient(90deg, var(--orange), var(--red));
      color: #fff; padding: 18px 20px;
      font-size: 20px; font-weight: 700;
      text-align: center;
    }
    .stats-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: #222;
      color: #fff;
      font-weight: 600;
    }
    .stats-bar div {
      flex: 1;
      text-align: center;
      padding: 8px;
      border-radius: 6px;
      margin: 0 4px;
    }
    #totalCredit { background:#2e7d32; }  /* ‡§π‡§ø‡§∞‡§µ‡§æ */
    #balance { background:#1565c0; }      /* ‡§®‡§ø‡§≥‡§æ */
    #totalDebit { background:#c62828; }   /* ‡§≤‡§æ‡§≤ */

    .wrap { max-width: 95%; margin: auto; padding: 16px; }
    h2 { margin: 16px 0 8px; font-weight: 700; text-align:center; }
    .form-row { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
    input, select {
      flex: 1 1 160px;
      padding: 10px; font-size: 14px;
      border: 1px solid #ccc; border-radius: 6px;
    }
    button {
      background: linear-gradient(45deg, var(--orange), var(--red));
      border: none; color: #fff;
      padding: 10px 16px; border-radius: 6px;
      font-size: 14px; font-weight: 600; cursor: pointer;
      transition: .2s;
    }
    button:hover { opacity: .9; }
    #status { margin: 8px 0; min-height: 20px; font-size: 14px; text-align:center; }

    table {
      width: 100%; border-collapse: collapse;
      margin: 14px 0 24px; font-size: 14px;
    }
    th, td {
      border: 1px solid #333; padding: 8px;
      text-align: center;
    }
    th { background: #f0f0f0; font-weight:600; }
    .credit { background: #d4f8d4; } /* ‡§π‡§ø‡§∞‡§µ‡§æ */
    .debit  { background: #f8d4d4; } /* ‡§≤‡§æ‡§≤  */

    /* Mobile friendly */
    @media(max-width:600px){
      header { font-size:18px; }
      .stats-bar { flex-direction: column; }
      .stats-bar div { margin:6px 0; }
      input, select, button { flex: 1 1 100%; font-size: 14px; }
      th, td { font-size: 12px; padding:6px; }
    }
  </style>
</head>
<body>
  <header>
    üö© ‡§ö‡•å‡§™‡§æ‡§ü‡•Ä ‡§§‡§∞‡•Å‡§£ ‡§Æ‡§Ç‡§°‡§≥, ‡§ó‡•ã‡§∞‡§Ç‡§¨‡•á üö©
  </header>

  <!-- Credit / Balance / Debit stats bar -->
  <div class="stats-bar">
    <div id="totalCredit">‡§è‡§ï‡•Ç‡§£ ‡§ú‡§Æ‡§æ: ‚Çπ0</div>
    <div id="balance">‡§∂‡§ø‡§≤‡•ç‡§≤‡§ï: ‚Çπ0</div>
    <div id="totalDebit">‡§è‡§ï‡•Ç‡§£ ‡§ñ‡§∞‡•ç‡§ö: ‚Çπ0</div>
  </div>

  <div class="wrap">
    <h2>‡§®‡•ã‡§Ç‡§¶ ‡§ú‡•ã‡§°‡§æ</h2>
    <div class="form-row">
      <input type="date" id="date" />
      <input type="number" id="amount" placeholder="‡§∞‡§ï‡•ç‡§ï‡§Æ (‚Çπ)" />
      <input type="text" id="note" placeholder="‡§®‡•ã‡§Ç‡§¶" />
      <select id="type">
        <option value="credit">Credit (‡§ú‡§Æ‡§æ)</option>
        <option value="debit">Debit (‡§ñ‡§∞‡•ç‡§ö)</option>
      </select>
      <button id="addBtn">‡§®‡•ã‡§Ç‡§¶ ‡§ú‡•ã‡§°‡§æ</button>
      <button id="csvBtn">üì• ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° (CSV)</button>
    </div>
    <div id="status"></div>

    <h2>‡§∏‡§∞‡•ç‡§µ‡§æ‡§Ç‡§ö‡§æ ‡§á‡§§‡§ø‡§π‡§æ‡§∏</h2>
    <table id="recordsTable">
      <thead>
        <tr>
          <th>‡§§‡§æ‡§∞‡•Ä‡§ñ</th>
          <th>‡§∞‡§ï‡•ç‡§ï‡§Æ (‚Çπ)</th>
          <th>‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</th>
          <th>‡§®‡•ã‡§Ç‡§¶</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // üîê Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAarxGMMLrVdM6r1-7p3Y1s9EMLtFZBCHE",
  authDomain: "fir-40504.firebaseapp.com",
  projectId: "fir-40504",
  storageBucket: "fir-40504.firebasestorage.app",
  messagingSenderId: "133340281936",
  appId: "1:133340281936:web:076e92582342ff3b22e555",
  measurementId: "G-CVCC5XLSCQ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // UI refs
    const dateEl = document.getElementById('date');
    const amountEl = document.getElementById('amount');
    const noteEl = document.getElementById('note');
    const typeEl = document.getElementById('type');
    const addBtn = document.getElementById('addBtn');
    const csvBtn = document.getElementById('csvBtn');
    const statusEl = document.getElementById('status');

    const totalCreditEl = document.getElementById('totalCredit');
    const totalDebitEl = document.getElementById('totalDebit');
    const balanceEl = document.getElementById('balance');
    const tbody = document.querySelector('#recordsTable tbody');

    let totalCredit = 0, totalDebit = 0;
    let allRecords = [];

    // Add record
    addBtn.addEventListener('click', async () => {
      const date = dateEl.value;
      const amount = parseFloat(amountEl.value);
      const note = noteEl.value.trim();
      const type = typeEl.value;

      if(!date || !amount || !note){
        statusEl.textContent = '‚ùó ‡§ï‡•É‡§™‡§Ø‡§æ ‡§§‡§æ‡§∞‡•Ä‡§ñ, ‡§∞‡§ï‡•ç‡§ï‡§Æ ‡§Ü‡§£‡§ø ‡§®‡•ã‡§Ç‡§¶ ‡§≠‡§∞‡§æ.';
        return;
      }

      try {
        const newRef = db.ref('records').push();
        await newRef.set({ date, amount, note, type });
        statusEl.textContent = '‚úÖ ‡§®‡•ã‡§Ç‡§¶ ‡§∏‡•á‡§µ‡•ç‡§π ‡§ù‡§æ‡§≤‡•Ä.';
        dateEl.value = ''; amountEl.value = ''; noteEl.value = '';
      } catch (err) {
        statusEl.textContent = '‚ùå ‡§∏‡•á‡§µ‡•ç‡§π ‡§ï‡§∞‡§§‡§æ‡§®‡§æ ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä: ' + err.message;
        console.error(err);
      }
    });

    // Rebuild table whenever data changes
    db.ref('records').on('value', (snap) => {
      tbody.innerHTML = '';
      totalCredit = 0; totalDebit = 0;
      allRecords = [];

      snap.forEach(child => {
        const r = child.val();
        const tr = document.createElement('tr');
        tr.className = (r.type === 'credit') ? 'credit' : 'debit';
        tr.innerHTML =
          `<td>${r.date||''}</td>
           <td>‚Çπ${Number(r.amount||0)}</td>
           <td>${r.type==='credit'?'‡§ú‡§Æ‡§æ':'‡§ñ‡§∞‡•ç‡§ö'}</td>
           <td>${r.note||''}</td>`;
        tbody.appendChild(tr);

        const amt = Number(r.amount||0);
        if (r.type === 'credit') totalCredit += amt;
        else totalDebit += amt;

        allRecords.push([r.date, amt, (r.type==='credit'?'‡§ú‡§Æ‡§æ':'‡§ñ‡§∞‡•ç‡§ö'), r.note]);
      });

      // Update stats
      const balance = totalCredit - totalDebit;
      totalCreditEl.textContent = '‡§è‡§ï‡•Ç‡§£ ‡§ú‡§Æ‡§æ: ‚Çπ' + totalCredit;
      totalDebitEl.textContent = '‡§è‡§ï‡•Ç‡§£ ‡§ñ‡§∞‡•ç‡§ö: ‚Çπ' + totalDebit;
      balanceEl.textContent = '‡§∂‡§ø‡§≤‡•ç‡§≤‡§ï: ‚Çπ' + balance;
    });

    // CSV download
    csvBtn.addEventListener('click', () => {
      let csv = "‡§§‡§æ‡§∞‡•Ä‡§ñ,‡§∞‡§ï‡•ç‡§ï‡§Æ,‡§™‡•ç‡§∞‡§ï‡§æ‡§∞,‡§®‡•ã‡§Ç‡§¶\n" + allRecords.map(r => r.map(x => {
        const s = (x ?? '').toString().replace(/"/g,'""');
        return /[,\"\n]/.test(s) ? `"${s}"` : s;
      }).join(',')).join('\n');

      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'mandal_history.csv';
      document.body.appendChild(a); a.click();
      URL.revokeObjectURL(url); a.remove();
    });
  </script>
</body>
</html>
